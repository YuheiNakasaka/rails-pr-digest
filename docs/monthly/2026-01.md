---
title: 2026年 1月
description: Ruby on Rails PR Digest - 2026年 1月にマージされたPRの要約
lastUpdated: 2026-01-03
---

# Ruby on Rails PR Digest - 2026年 1月

> このページは [rails/rails](https://github.com/rails/rails) リポジトリにマージされたPull Requestを自動的に収集し、AIで要約したものです。


## [#56507](https://github.com/rails/rails/pull/56507) Remove non existing autoload for sucker punch {#pr-56507}

**マージ日**: 2026/1/2 | **作成者**: [@morgoth](https://github.com/morgoth)

1. 概要 (1-2文で)  
Active Job のキューアダプタ定義から、存在しない「sucker_punch」関連の autoload 設定が1行削除されました。  
古いコミットの「消し残し」を整理する、挙動にはほぼ影響しないリファクタリングです。

---

2. 変更内容の詳細(あればサンプルコードも含めて)  

対象ファイル:  
- `activejob/lib/active_job/queue_adapters.rb`

削除されたのは、`ActiveJob::QueueAdapters` モジュール内の autoload 設定の1行です。イメージとしては次のようなコードが削除されています:

```ruby
module ActiveJob
  module QueueAdapters
    # こういった autoload 群の中に
    # autoload :SuckerPunch, "active_job/queue_adapters/sucker_punch_adapter"
    # のような1行が削除された
  end
end
```

説明文にある通り、この autoload は以下のコミット後の「残骸」とみなされています:
- https://github.com/rails/rails/commit/634f90b883ef0e4af5ba32bba7ca55a7efbe4701

そのコミット側で Sucker Punch 関連のサポートやクラス定義が削除・変更されたにもかかわらず、autload 行だけが残っていたため、今回の PR で整理された形です。

---

3. 影響範囲・注意点  

- Rails/Active Job から公式に提供される `sucker_punch` キューアダプタに依存しているコードは、既に前のコミット時点で実質的に壊れているか、非サポート状態になっています。この PR はそれを明示的にクリアにする小さな整理です。  
- 現時点で `ActiveJob::QueueAdapters::SuckerPunch` を直接参照していた場合:
  - そのクラス／モジュール自体が以前のコミットで無くなっているか、ロードされない状態になっている可能性が高く、今回の PR だけが原因で壊れるケースはほとんどありません。
- Sucker Punch を使いたい場合:
  - 独自の queue adapter を定義して利用するか、
  - すでにメンテされている外部 gem（あれば）を利用する必要があります。
- アプリ側で autoload ではなく、`require "active_job/queue_adapters/sucker_punch_adapter"` のような直接ロードをしている場合:
  - ファイル自体が存在しない／削除済みであれば、`LoadError` が発生します。  
  - これはこの PR ではなく、すでに行われた Sucker Punch サポート削除側の変更の影響です。

---

4. 参考情報 (あれば)  

- この PR が「残骸」として指摘しているコミット:  
  https://github.com/rails/rails/commit/634f90b883ef0e4af5ba32bba7ca55a7efbe4701  
  ここで Sucker Punch 関連のコードが整理・削除されており、今回その後処理として autoload 行が取り除かれました。  
- Active Job のキューアダプタの仕組み:  
  - Rails ガイド（英語）: https://guides.rubyonrails.org/active_job_basics.html#backends  
  - ここに載っているバックエンド一覧からも、Sucker Punch は今後消えていく／既に消えている可能性が高いと考えられます。

---


## [#56490](https://github.com/rails/rails/pull/56490) Add Rails.app.revision {#pr-56490}

**マージ日**: 2025/12/31 | **作成者**: [@byroot](https://github.com/byroot)

1. 概要 (1–2文で)  
`Rails.app.revision` という新しいAPIが追加され、アプリケーションの「リビジョン(デプロイごとの識別子)」をRails側からシンプルに参照できるようになりました。デプロイトラッキング、エラーレポート、監視、キャッシュキーなどで、統一的にアプリのバージョン/リビジョンを扱うための仕組みです。

---

2. 変更内容の詳細  

※PR本文から読み取れる範囲での要約になります。実際のコードは概ね以下のような形の機能を提供していると考えられます。

### 2-1. `Rails.app.revision` の追加

`Rails.application` に対応する形で、グローバルにアプリケーションのリビジョンを取得できるAPIが追加されています:

```ruby
Rails.app.revision
# => "20250101-abcdef" など(環境に応じた値)
```

想定される用途:
- デプロイごとのリビジョンIDをログやメトリクスに載せる
- エラーレポーティングサービス(Sentry など)への `release`/`version` として渡す
- ヘルスチェック / info エンドポイントでアプリのバージョン情報を返す
- キャッシュキーにリビジョンを混ぜて、リリース単位でキャッシュ無効化を行う など

### 2-2. アプリケーション設定 (`Rails::Application::Configuration`) の拡張

`config/application.rb` 経由で設定できるように、`configuration` に `revision` が追加されています。たとえば:

```ruby
# config/application.rb
module MyApp
  class Application < Rails::Application
    config.revision = ENV["APP_REVISION"] || `git rev-parse HEAD`.chomp
  end
end
```

これにより、アプリ起動時に任意の値をリビジョンとして設定でき、以後 `Rails.app.revision` から参照できるようになります。

### 2-3. ブートストラップ処理での初期化

`rails/application/bootstrap.rb` にも変更があり、ブートシーケンスのどこかで `revision` を初期化／確定する処理が追加されています。

可能性としては:

- 設定されていれば `config.revision` を使用
- なければ環境変数 (例: `ENV["RAILS_APP_REVISION"]` など) を見る
- それもなければ Git 情報や、`REVISION` ファイルなど、一般的なデプロイの慣習を利用

といったフォールバックを行う実装が考えられます（PR #56080 の修正とあるので、前回の実装のバグや不整合を解消した整理版の実装とも言えます）。

### 2-4. `Rails::Info` への統合

`railties/lib/rails/info.rb` にも追記されているため、`rails info` やアプリから提供される「Rails info」ページに、アプリケーションのリビジョンが表示されるようになっています。

例:

```bash
$ bin/rails info
# 中略
Application revision: 20250101-abcdef
```

### 2-5. ガイド・CHANGELOG・テストの追加

- `guides/source/configuring.md`  
  アプリケーション設定のガイドに、`config.revision` / `Rails.app.revision` の設定・利用方法が記載されています。
- `railties/CHANGELOG.md`  
  Rails本体の変更履歴に、この新APIが追加されたことが明記されています。
- `railties/test/application/app_revision_test.rb`  
  `revision` の決定ロジックや公開APIの挙動を確認するテストが追加され、仕様が固定化されています。

---

3. 影響範囲・注意点  

- **新機能であり、既存コードを壊さない**  
  既存アプリで特に設定しなければ、`Rails.app.revision` は `nil` もしくはデフォルトの値になるだけで、既存挙動を壊す変更ではありません。

- **デプロイフローとの統合がポイント**  
  実用的に使うには、CI/CDなどデプロイプロセスのどこかで一貫したリビジョン値をセットする必要があります。
  - 例: `ENV["APP_REVISION"]` をCIでGit SHAに設定 → `config.revision = ENV["APP_REVISION"]`
  - 例: Capistrano系のデプロイなら `REVISION` ファイルを生成し、それを読むロジックを `config.revision` に書く など

- **キャッシュキーに組み込む場合の注意**  
  リビジョンをキャッシュキーに混ぜると、「デプロイのたびにキャッシュがリセットされる」挙動になります。キャッシュミス増加とトラフィックに注意しつつ、意図した箇所だけに適用するのが安全です。

- **エラーレポート・監視との連携**  
  監視/エラートラッキングの初期化処理で `Rails.app.revision` を見に行くようにしておくと、コードベースに依存せずリビジョン取得方法を差し替えられます。

  ```ruby
  Sentry.init do |config|
    config.release = Rails.app.revision
  end
  ```

---

4. 参考情報 (あれば)  

- 修正対象となったPR: https://github.com/rails/rails/pull/56080  
  （本PRは、その修正・改良版として `Rails.app.revision` を整備している）  
- 設定ガイド (`guides/source/configuring.md`) に、実際の設定例や推奨の使い方が追記されているため、詳細な利用方法はそちらを参照するとよいです。

---

