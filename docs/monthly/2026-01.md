---
title: 2026年 1月
description: Ruby on Rails PR Digest - 2026年 1月にマージされたPRの要約
lastUpdated: 2026-01-04
---

# Ruby on Rails PR Digest - 2026年 1月

> このページは [rails/rails](https://github.com/rails/rails) リポジトリにマージされたPull Requestを自動的に収集し、AIで要約したものです。


## [#56471](https://github.com/rails/rails/pull/56471) Override inspect in Combined, Env & Encrypted Configurations {#pr-56471}

**マージ日**: 2026/1/3 | **作成者**: [@siaw23](https://github.com/siaw23)

1. 概要 (1-2文で)  
Rails の `CombinedConfiguration`, `EnvConfiguration`, `EncryptedConfiguration` の `inspect` 出力から、実際のシークレット値や ENV の中身を隠し、キー名だけが見えるようにした変更です。コンソール・ログ・エラーレポート等で機密情報が漏洩するリスクを減らすセキュリティ改善です。

---

2. 変更内容の詳細  

### 何が問題だったか

従来は以下のように、`inspect` が内部状態をそのまま表示していました:

```ruby
Rails.app.creds
#<ActiveSupport::CombinedConfiguration:0x0000000122b45870
 @configurations=[
   #<ActiveSupport::EnvConfiguration:0x0000000122b465b8
    @envs={"SOME_SECRET" => "secret_value", "DATABASE_URL" => "postgresql://user:pass@host/db", ...}>,
   #<ActiveSupport::EncryptedConfiguration:0x00000000007af0>
 ]
>
```

ここでは:

- `ENV` の値 (`DATABASE_URL` のユーザ名・パスワードなど)
- 各種クレデンシャル (`SOME_SECRET` など)
- その他内部状態

が丸見えになっており、以下のようなシチュエーションで機密情報が簡単に漏れる危険がありました。

- Rails コンソールでオブジェクトをうっかり `p` した / 例外から `inspect` に巻き込まれた
- ログにオブジェクトをそのまま出力した
- エラーレポートや APM が `inspect` を呼び出して情報を集めた

### どう変わったか

この PR では、3つのクラスで `inspect` をオーバーライドし、**値ではなくキーだけ**を表示するようにしています。

#### CombinedConfiguration

```ruby
Rails.app.creds
#<ActiveSupport::CombinedConfiguration:0x00000000006490
  keys=[:rails_env, :some_secret, ..., :secret_key_base, :stripe_webhook_secret]>
```

ポイント:

- 元々は `@configurations` 配列(EnvConfiguration, EncryptedConfigurationなど)の生の内容が出ていた
- 今は `keys=[...]` だけを出す
- 各キーは **シンボル** として表示される (`:some_secret` など)

#### EncryptedConfiguration

```ruby
Rails.app.credentials
#<ActiveSupport::EncryptedConfiguration:0x00000000008cd0
  keys=[:secret_key_base, :stripe_webhook_secret]>
```

ポイント:

- これまでは内部構造や値が `inspect` から見えていた
- 変更後は復号後の **キー名のみ** をシンボルで表示
- コード上のアクセス方法 (`config.some_secret`) と自然に対応する形

#### EnvConfiguration

```ruby
Rails.app.envs
#<ActiveSupport::EnvConfiguration:0x0000000000a6a0
  keys=[:rails_env, :some_secret, :path, :home, ...]>
```

ポイント:

- これまでは `@envs={ "KEY" => "VALUE", ... }` のように生の ENV 内容が出ていた
- 今は ENV のキーだけを `keys=[...]` として表示
- ENV のキーは本来文字列ですが、`inspect` 上ではシンボル化して見せることで API と整合性をとっている（他2つと同様）

#### 実装レベルの変更点（想定される形）

コード自体は省略されていますが、概ね以下のイメージです:

```ruby
# 例: EncryptedConfiguration
def inspect
  keys = self.keys.map(&:to_sym)
  "#<#{self.class}:0x#{(object_id << 1).to_s(16)} keys=#{keys.inspect}>"
end
```

- `object_id` の表示形式は標準の `inspect` に合わせている
- `keys` メソッド（もしくは同等のアクセサ）を使ってキーの一覧を取得
- 値にはアクセスしないため、復号やENVアクセスによる副作用／遅延も最小限

#### テスト・CHANGELOG

- `combined_configuration_test.rb`, `encrypted_configuration_test.rb`, `env_configuration_test.rb` に `inspect` の期待出力に関するテストを追加
- `activesupport/CHANGELOG.md` に挙動変更として記載（= パブリックな振る舞いの変更と位置づけ）

---

3. 影響範囲・注意点  

- **セキュリティ上は明確な改善**  
  ログ・コンソール・エラー画面経由でのシークレット・ENV漏洩リスクが大きく減ります。特に本番環境や共有されるログを扱う環境ではプラス。

- **`inspect` に値の露出を期待していたコードは壊れる**  
  本来そうあるべきではありませんが、もし以下のようなコードを書いていた場合は動かなくなります:

  ```ruby
  # NG パターン（値を取り出す目的で inspect をパースしている等）
  Rails.app.credentials.inspect.include?("secret_value")
  ```

  `inspect` はデバッグ用途であり、パースしてロジックに使うことは非推奨です。値が必要な場合は正規の API (`[]`, メソッドアクセスなど) を明示的に使う必要があります。

- **デバッグ体験の変化**  
  これまでコンソールで

  ```ruby
  Rails.app.credentials
  ```

  を実行して中身の具体的な値を一覧していたワークフローは使えなくなります。今後は:

  - キー一覧: `Rails.app.credentials.keys`
  - 個別キーの値確認: `Rails.app.credentials.some_secret` や `Rails.app.credentials[:some_secret]`

  といった形で **意図的に** 参照する必要があります。

- **動作そのもの（設定の読み込み・参照など）には影響なし**  
  変わるのは `inspect` の出力だけであり、設定値の解決・利用ロジックは従来通りです。

---

4. 参考情報 (あれば)  

- この PR は `ActiveSupport::CombinedConfiguration`, `ActiveSupport::EnvConfiguration`, `ActiveSupport::EncryptedConfiguration` の「公開インタフェースの一部」である `inspect` の挙動変更なので、今後の Rails バージョンアップ時には **挙動差分** として認識しておくとよいです。  
- 類似の流れとして、近年のフレームワークやライブラリでは、`inspect` や `to_s` で機密情報を出さないようにするのが一般的なトレンドです（DBパスワード、APIキー、トークンなど）。今回の変更もその一環と言えます。

---


## [#53334](https://github.com/rails/rails/pull/53334) Deprecate built-in ActiveJob backburner adapter {#pr-53334}

**マージ日**: 2026/1/3 | **作成者**: [@dixpac](https://github.com/dixpac)

1. 概要 (1-2文で)  
Active Job に組み込みで用意されている Backburner アダプタが「非推奨（deprecate）」としてマークされました。今後のバージョンで削除される可能性が高く、別のアダプタや実装への移行が推奨されます。

---

2. 変更内容の詳細  

※PR本文に説明がないため、Rails で一般的に行われる「アダプタの非推奨化」のパターンからの推測を含みますが、差分ファイル構成から見て妥当な範囲にとどめます。

### 2-1. CHANGELOG の更新

`activejob/CHANGELOG.md` に、Backburner アダプタの非推奨化が明記されました。  
これにより、「このリリースから backburner アダプタは deprecated」という公式な位置付けになります。

例（イメージ）:

```markdown
*   Deprecate the built-in Active Job Backburner adapter.

    *dixpac*
```

今後のリリースノートやアップグレードガイドで、この記述が参照されることになります。

### 2-2. Backburner アダプタ本体への非推奨マーク

`activejob/lib/active_job/queue_adapters/backburner_adapter.rb` に、非推奨であることを示すコードが追加されています。Rails では典型的に以下のような形で実装されます:

- `ActiveSupport::Deprecation.warn` を使った実行時警告
- またはクラス／モジュールのコメント・doc に「Use X instead」「This adapter is deprecated」などを追記
- 場合によっては `deprecate` マクロ使用

イメージコード:

```ruby
module ActiveJob
  module QueueAdapters
    class BackburnerAdapter
      def initialize(*)
        ActiveSupport::Deprecation.warn(
          "Active Job's built-in Backburner adapter is deprecated " \
          "and will be removed in a future release. " \
          "Please use a custom adapter gem or another supported adapter instead."
        )
        super
      end
      # ...
    end
  end
end
```

※実際のコードは若干異なる可能性がありますが、行数的にこの種の deprecation 警告追加でほぼ確実です。

### 2-3. テストの追加

`activejob/test/cases/adapter_test.rb` にテストが 27 行追加されています。

想定される内容:

- Backburner アダプタを指定したときに、deprecation warning が出ることを検証するテスト
- `assert_deprecated` / `assert_deprecation_warning` などのヘルパを用いて、警告メッセージの存在と内容を確認
- 既存の「各アダプタが正しく動作するか」をテストしているケースに、Backburner の deprecation を組み込んだ形

サンプルイメージ:

```ruby
def test_backburner_adapter_is_deprecated
  assert_deprecated(/Backburner adapter is deprecated/) do
    ActiveJob::Base.queue_adapter = :backburner
  end
end
```

これにより、将来の変更で deprecation 警告が消えてしまったり、文言が意図せず変わることを防いでいます。

---

3. 影響範囲・注意点  

### 3-1. 現在 Backburner アダプタを利用しているアプリ

`config/application.rb` などで:

```ruby
config.active_job.queue_adapter = :backburner
```

と設定している場合、Rails の新しいバージョンに上げると、実行時に deprecation warning が出るようになります。

#### 対応の方向性

- 中長期的には、以下のいずれかを検討する必要があります:
  - Backburner 用の外部 gem（コミュニティ製アダプタ）に移行
  - 別の公式サポートされているキューアダプタ（Sidekiq, Resque, Delayed Job, Que, Solid Queue など）へ移行
  - 自前で `ActiveJob::QueueAdapter` を実装して独自アダプタを作る

将来的に Rails 本体から backburner アダプタが削除されると、`queue_adapter = :backburner` は例外を投げるようになると考えられます。

### 3-2. テストや CI 上のノイズ

- RSpec や Minitest で deprecation をエラー扱いにしている場合、Backburner を使ったテストが落ちる可能性があります。
- CI のログに deprecation が大量に出るようであれば、
  - 早めのアダプタ移行
  - 一時的な deprecation フィルタリング（`ActiveSupport::Deprecation.behavior` 設定）
などの対応が必要です。

### 3-3. ライブラリ／エンジン作者への影響

- gem や Rails Engine で `queue_adapter = :backburner` をデフォルトにしている場合、その gem の利用者がアップデート時に deprecation を見ることになります。
- 利用者への影響を抑えるために、README や CHANGELOG に「Backburner adapter は非推奨」「今後の対応方針」を明記しておくとよいです。

---

4. 参考情報 (あれば)  

- Active Job ガイド（公式ドキュメント・英語）  
  https://guides.rubyonrails.org/active_job_basics.html  
  （Queue adapters セクションにサポートされているアダプタ一覧と設定方法があります）

- 独自アダプタ実装の参考:  
  ActiveJob のアダプタは一般に `ActiveJob::QueueAdapter` インターフェイス（`enqueue`, `enqueue_at` など）を実装したクラスとして書けます。公式ガイドや既存アダプタ（sidekiq, resque 等）の実装を参照すると、Backburner 向けの外部アダプタを作る際の参考になります。

この PR 時点では「即座に動かなくなる」変更ではなく、「公式 Backburner アダプタは今後消える前提なので、今のうちに移行を始めてください」という位置付けの変更と考えてよいです。

---


## [#56508](https://github.com/rails/rails/pull/56508) Remove proc support in config.revision {#pr-56508}

**マージ日**: 2026/1/3 | **作成者**: [@byroot](https://github.com/byroot)

1. 概要 (1-2文で)  
`config.revision` で Proc（ラムダ / ブロック）を指定するサポートが削除され、常に「その場で評価された値」を設定する前提の API に整理されました。これにより設定方法がシンプルになり、ガイドやテストもそれに合わせて縮小されています。

---

2. 変更内容の詳細

※ PR本文は短く差分も小さいので、Rails の既存実装から推測を含めた解説になります。

### 2-1. `config.revision` の仕様整理

以前の実装では、`config.revision` に以下のように Proc を渡すことが可能だったと考えられます。

```ruby
# 旧: Proc を渡すケース (今回削除された使い方)
config.revision = -> { `git rev-parse HEAD`.chomp }
```

アプリケーション内部ではこの Proc が「後から呼び出される」か、「即時に呼び出した結果を使う」かの分岐が存在していました。

今回の PR では、「どうせすぐ呼び出して値にしてしまう」ように振る舞いが変わったため、わざわざ Proc を受け付ける意味がなくなり、**Proc サポート自体が削除**されています。

結果として、推奨される書き方は次のようになります。

```ruby
# 新: 値をその場で評価して代入する
config.revision = `git rev-parse HEAD`.chomp
```

あるいは、環境変数などの静的な値を使う場合:

```ruby
config.revision = ENV["APP_REVISION"] # 文字列などの即値のみ
```

Rails コア側の実装 (`Rails::Application` 付近) からは:

- `config.revision` が Proc かどうかを判定するコード
- Proc なら `call` して結果を使うロジック

といった分岐が削除され、**常に「単なる値（String など）」として扱う**ようになっています。

### 2-2. ガイドとテストの変更

- `guides/source/configuring.md`  
  - `config.revision` の説明から Proc を使う例や記述が削除され、「値を直接設定する」前提の説明に整理されています。
- `railties/test/application/app_revision_test.rb`  
  - Proc を設定したときの挙動を確認していたテストケースが削除され、もはや Proc をサポートしていない仕様が明確になりました。

行数の統計からも、機能削除に伴うテストとドキュメントの簡素化が中心で、追加はほぼ「仕様を明示するための最小限の変更」のみです。

---

3. 影響範囲・注意点

### 3-1. 影響を受けるコード

次のようなコードを書いている場合は壊れます:

```ruby
# NG となるコード (この PR 後はサポートされない)
config.revision = -> { ENV.fetch("APP_REVISION") }
config.revision = proc { `git rev-parse HEAD`.chomp }
```

この PR により `config.revision` に Proc を渡すこと自体が非対応になったため、  
**Rails をこのバージョン以降に上げると、起動時にエラー or 期待しない値になる**可能性があります。

### 3-2. 移行方法

以下のように「その場で評価した結果を代入」する形に書き換えてください。

```ruby
# よくある置き換えパターン

# Before
config.revision = -> { `git rev-parse HEAD`.chomp }

# After
config.revision = `git rev-parse HEAD`.chomp
```

```ruby
# Before
config.revision = -> { ENV["APP_REVISION"] || "unknown" }

# After
config.revision = ENV["APP_REVISION"] || "unknown"
```

Proc にしていた理由が「遅延評価したい」ことであれば、今回の仕様では  
`config.revision` はあくまで「起動時に一度決める固定値」として扱う設計に寄せられたと理解するのが安全です。  
リクエストごとに変わる値や重い計算をしたい場合は、別のレイヤ（ミドルウェアやサービスクラス）で扱う必要があります。

### 3-3. ランタイムでの変更について

`config.revision` は Rails の設定オブジェクトなので、「起動後に差し替える」ことを前提にはしていません。  
この PR により、**設定値は純粋なオブジェクト（多くは String）である**ことが暗黙的に強くなったため、  
「Proc を使ってランタイムで変わる値にしたい」といった用途には向かなくなっています。

---

4. 参考情報 (あれば)

- PR: https://github.com/rails/rails/pull/56508  
- 近いコンテキストとして、`config.revision` は Heroku 等のデプロイ環境で「アプリのリビジョン（Git SHA など）」を格納し、  
  エラーレポートやメトリクス、ヘルスチェックページ等から参照する用途を想定した設定項目です。  
- 将来の Rails リリースノートやアップグレードガイドで「`config.revision` から Proc サポートが削除された」旨が記載される可能性が高いので、  
  バージョンアップ時はその記述も併せて確認すると安全です。

---


## [#56507](https://github.com/rails/rails/pull/56507) Remove non existing autoload for sucker punch {#pr-56507}

**マージ日**: 2026/1/2 | **作成者**: [@morgoth](https://github.com/morgoth)

1. 概要 (1-2文で)  
Active Job のキューアダプタ定義から、存在しない「sucker_punch」関連の autoload 設定が1行削除されました。  
古いコミットの「消し残し」を整理する、挙動にはほぼ影響しないリファクタリングです。

---

2. 変更内容の詳細(あればサンプルコードも含めて)  

対象ファイル:  
- `activejob/lib/active_job/queue_adapters.rb`

削除されたのは、`ActiveJob::QueueAdapters` モジュール内の autoload 設定の1行です。イメージとしては次のようなコードが削除されています:

```ruby
module ActiveJob
  module QueueAdapters
    # こういった autoload 群の中に
    # autoload :SuckerPunch, "active_job/queue_adapters/sucker_punch_adapter"
    # のような1行が削除された
  end
end
```

説明文にある通り、この autoload は以下のコミット後の「残骸」とみなされています:
- https://github.com/rails/rails/commit/634f90b883ef0e4af5ba32bba7ca55a7efbe4701

そのコミット側で Sucker Punch 関連のサポートやクラス定義が削除・変更されたにもかかわらず、autload 行だけが残っていたため、今回の PR で整理された形です。

---

3. 影響範囲・注意点  

- Rails/Active Job から公式に提供される `sucker_punch` キューアダプタに依存しているコードは、既に前のコミット時点で実質的に壊れているか、非サポート状態になっています。この PR はそれを明示的にクリアにする小さな整理です。  
- 現時点で `ActiveJob::QueueAdapters::SuckerPunch` を直接参照していた場合:
  - そのクラス／モジュール自体が以前のコミットで無くなっているか、ロードされない状態になっている可能性が高く、今回の PR だけが原因で壊れるケースはほとんどありません。
- Sucker Punch を使いたい場合:
  - 独自の queue adapter を定義して利用するか、
  - すでにメンテされている外部 gem（あれば）を利用する必要があります。
- アプリ側で autoload ではなく、`require "active_job/queue_adapters/sucker_punch_adapter"` のような直接ロードをしている場合:
  - ファイル自体が存在しない／削除済みであれば、`LoadError` が発生します。  
  - これはこの PR ではなく、すでに行われた Sucker Punch サポート削除側の変更の影響です。

---

4. 参考情報 (あれば)  

- この PR が「残骸」として指摘しているコミット:  
  https://github.com/rails/rails/commit/634f90b883ef0e4af5ba32bba7ca55a7efbe4701  
  ここで Sucker Punch 関連のコードが整理・削除されており、今回その後処理として autoload 行が取り除かれました。  
- Active Job のキューアダプタの仕組み:  
  - Rails ガイド（英語）: https://guides.rubyonrails.org/active_job_basics.html#backends  
  - ここに載っているバックエンド一覧からも、Sucker Punch は今後消えていく／既に消えている可能性が高いと考えられます。

---


## [#56490](https://github.com/rails/rails/pull/56490) Add Rails.app.revision {#pr-56490}

**マージ日**: 2025/12/31 | **作成者**: [@byroot](https://github.com/byroot)

1. 概要 (1–2文で)  
`Rails.app.revision` という新しいAPIが追加され、アプリケーションの「リビジョン(デプロイごとの識別子)」をRails側からシンプルに参照できるようになりました。デプロイトラッキング、エラーレポート、監視、キャッシュキーなどで、統一的にアプリのバージョン/リビジョンを扱うための仕組みです。

---

2. 変更内容の詳細  

※PR本文から読み取れる範囲での要約になります。実際のコードは概ね以下のような形の機能を提供していると考えられます。

### 2-1. `Rails.app.revision` の追加

`Rails.application` に対応する形で、グローバルにアプリケーションのリビジョンを取得できるAPIが追加されています:

```ruby
Rails.app.revision
# => "20250101-abcdef" など(環境に応じた値)
```

想定される用途:
- デプロイごとのリビジョンIDをログやメトリクスに載せる
- エラーレポーティングサービス(Sentry など)への `release`/`version` として渡す
- ヘルスチェック / info エンドポイントでアプリのバージョン情報を返す
- キャッシュキーにリビジョンを混ぜて、リリース単位でキャッシュ無効化を行う など

### 2-2. アプリケーション設定 (`Rails::Application::Configuration`) の拡張

`config/application.rb` 経由で設定できるように、`configuration` に `revision` が追加されています。たとえば:

```ruby
# config/application.rb
module MyApp
  class Application < Rails::Application
    config.revision = ENV["APP_REVISION"] || `git rev-parse HEAD`.chomp
  end
end
```

これにより、アプリ起動時に任意の値をリビジョンとして設定でき、以後 `Rails.app.revision` から参照できるようになります。

### 2-3. ブートストラップ処理での初期化

`rails/application/bootstrap.rb` にも変更があり、ブートシーケンスのどこかで `revision` を初期化／確定する処理が追加されています。

可能性としては:

- 設定されていれば `config.revision` を使用
- なければ環境変数 (例: `ENV["RAILS_APP_REVISION"]` など) を見る
- それもなければ Git 情報や、`REVISION` ファイルなど、一般的なデプロイの慣習を利用

といったフォールバックを行う実装が考えられます（PR #56080 の修正とあるので、前回の実装のバグや不整合を解消した整理版の実装とも言えます）。

### 2-4. `Rails::Info` への統合

`railties/lib/rails/info.rb` にも追記されているため、`rails info` やアプリから提供される「Rails info」ページに、アプリケーションのリビジョンが表示されるようになっています。

例:

```bash
$ bin/rails info
# 中略
Application revision: 20250101-abcdef
```

### 2-5. ガイド・CHANGELOG・テストの追加

- `guides/source/configuring.md`  
  アプリケーション設定のガイドに、`config.revision` / `Rails.app.revision` の設定・利用方法が記載されています。
- `railties/CHANGELOG.md`  
  Rails本体の変更履歴に、この新APIが追加されたことが明記されています。
- `railties/test/application/app_revision_test.rb`  
  `revision` の決定ロジックや公開APIの挙動を確認するテストが追加され、仕様が固定化されています。

---

3. 影響範囲・注意点  

- **新機能であり、既存コードを壊さない**  
  既存アプリで特に設定しなければ、`Rails.app.revision` は `nil` もしくはデフォルトの値になるだけで、既存挙動を壊す変更ではありません。

- **デプロイフローとの統合がポイント**  
  実用的に使うには、CI/CDなどデプロイプロセスのどこかで一貫したリビジョン値をセットする必要があります。
  - 例: `ENV["APP_REVISION"]` をCIでGit SHAに設定 → `config.revision = ENV["APP_REVISION"]`
  - 例: Capistrano系のデプロイなら `REVISION` ファイルを生成し、それを読むロジックを `config.revision` に書く など

- **キャッシュキーに組み込む場合の注意**  
  リビジョンをキャッシュキーに混ぜると、「デプロイのたびにキャッシュがリセットされる」挙動になります。キャッシュミス増加とトラフィックに注意しつつ、意図した箇所だけに適用するのが安全です。

- **エラーレポート・監視との連携**  
  監視/エラートラッキングの初期化処理で `Rails.app.revision` を見に行くようにしておくと、コードベースに依存せずリビジョン取得方法を差し替えられます。

  ```ruby
  Sentry.init do |config|
    config.release = Rails.app.revision
  end
  ```

---

4. 参考情報 (あれば)  

- 修正対象となったPR: https://github.com/rails/rails/pull/56080  
  （本PRは、その修正・改良版として `Rails.app.revision` を整備している）  
- 設定ガイド (`guides/source/configuring.md`) に、実際の設定例や推奨の使い方が追記されているため、詳細な利用方法はそちらを参照するとよいです。

---

