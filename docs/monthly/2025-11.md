---
title: 2025年 11月
description: Ruby on Rails PR Digest - 2025年 11月にマージされたPRの要約
lastUpdated: 2025-11-24
---

# Ruby on Rails PR Digest - 2025年 11月

> このページは [rails/rails](https://github.com/rails/rails) リポジトリにマージされたPull Requestを自動的に収集し、AIで要約したものです。


## [#56216](https://github.com/rails/rails/pull/56216) Fix TimeWithZone#xmlschema when wrapping DateTime local time

**マージ日**: 2025/11/24 | **作成者**: [@drymar](https://github.com/drymar)

1. 概要
このRuby on Railsのプルリクエスト（PR）は、`ActiveSupport::TimeWithZone#xmlschema`が、ローカルタイムとして使用された`DateTime`オブジェクトをラップした場合に無効なISO-8601文字列を生成する問題を修正します。

2. 変更内容の詳細
- `ActiveSupport::TimeWithZone#xmlschema`メソッドを、タイムゾーンのサフィックス（`Z`または`±HH:MM`）全体を置換するように変更しました。これにより、`Time`または`DateTime`オブジェクトのどちらをラップする場合でも正しいISO-8601形式の出力が確保されます。
- タイムゾーンオフセットの計算を正しく行うよう修正し、特に`DateTime`インスタンスでのエラーを防ぎました。
- バグを再現し、修正が適用されたことを確認するための回帰テスト`test_xmlschema_with_datetime_local_time`を追加しました。

3. 影響範囲・注意点
この修正は報告されたバグを解決するものであり、それ以外の行動変化は導入されていません。したがって、既存の機能に対する影響は最小限です。このPRは軽微なバグ修正であるため、CHANGELOGへの記載は必要とされません。

4. 参考情報
このPRは特定のバグ（issue #56112）に対応するものであり、その詳細はGitHubの[Railsリポジトリ](https://github.com/rails/rails/issues/56112)で確認できます。この変更により、`TimeWithZone`のISO-8601出力が、ラップしているオブジェクトに依存せず一貫性を持ちます。

---


## [#56212](https://github.com/rails/rails/pull/56212) Fix CI eager loading when rake tasks invoke :environment before tests

**マージ日**: 2025/11/23 | **作成者**: [@trevorturk](https://github.com/trevorturk)

1. 概要 (1-2文で)
このPRは、テスト環境での`config.eager_load`設定が、CIにおいて`:environment` Rakeタスクがテスト前に実行されると意図した通りに機能しない問題を修正します。

2. 変更内容の詳細
- 問題点として、`config.eager_load = ENV["CI"].present?`が、`tailwindcss-rails`のようなGEMが`:environment`タスクをフックする際に`config.rake_eager_load = false`にオーバーライドされてしまい、CIでeager loadingが無効化されることが挙げられています。
- 本PRでは、`config.rake_eager_load = ENV["CI"].present?`を生成されるテスト環境のテンプレートに追加しました。これにより、Rakeタスクがテスト前に実行されても一貫してeager loadingが実行されるようになります。

3. 影響範囲・注意点
- この修正は、CI環境でのeager loadingが確実に実行されることを保証し、特にZeitwerkのエラーを持つアプリケーションが`bin/rails test`と`bin/rails zeitwerk:check`で異なる結果を出す問題を防ぎます。
- また、このアプローチはRakeタスク自体の取り扱いを変更するのではなく、設定ファイルを調整することで問題を解決しており、他の部分に影響を与えるリスクが少ないと考えられます。

4. 参考情報 (あれば)
- この問題は、Rakeタスクがデフォルトでeager loadingを無効化する方式から来ており、特にRails 5.1以前の遺産問題に関連しています。`rake_eager_load`の設定を利用することで、Rakeタスクにおいても一貫したロード順序を保つことができます。
- 詳細な再現手順と問題の背景については、作成者が用意した最小限の再現ケース（https://github.com/trevorturk/issue_56065）を参照してください。

---


## [#56218](https://github.com/rails/rails/pull/56218) [ci skip] Add extension schema to the db/schema.rb example.

**マージ日**: 2025/11/23 | **作成者**: [@kakudou3](https://github.com/kakudou3)

1. 概要
このプルリクエストは、Ruby on Railsの`db/schema.rb`のサンプルに拡張スキーマ情報を追加することで、Rails 8以降を使用するユーザーの混乱を避けることを目的としています。

2. 変更内容の詳細
`active_record_migrations.md`の`db/schema.rb`のサンプルコードが、スキーマダンパーの更新に伴って不足している情報を反映していなかったため、これを修正しました。具体的には、PostgreSQLの`plpgsql`が`pg_catalog`スキーマに存在することを反映し、サンプルを`pg_catalog.plpgsql`として更新しました。これはPostgreSQL 16.1で確認されています。

3. 影響範囲・注意点
この変更はドキュメントの更新に該当し、直接的なコードの変更やアプリケーションの動作には影響を及ぼしません。しかし、新しいRailsバージョンに移行するユーザーにとって有益であり、拡張機能の有効化に関する理解を助けます。

4. 参考情報
このPRは、以前のPR #52313で行われたスキーマダンパーの変更を反映する意図があります。また、PostgreSQL 16.1の拡張機能情報を参照しており、`plpgsql`が`pg_catalog`スキーマに属することが確認されています。

---

