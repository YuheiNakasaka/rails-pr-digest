import { defineConfig } from 'vitepress'
import { readdirSync } from 'fs'
import { join } from 'path'

// Dynamically generate sidebar items from monthly directory
function getMonthlyItems() {
  try {
    const monthlyDir = join(__dirname, '../monthly')
    const files = readdirSync(monthlyDir)
      .filter(f => f.endsWith('.md'))
      .sort()
      .reverse() // Most recent first

    return files.map(filename => {
      const match = filename.match(/(\d{4})-(\d{2})\.md/)
      if (match) {
        const year = match[1]
        const month = parseInt(match[2])
        return {
          text: `${year}å¹´ ${month}æœˆ`,
          link: `/monthly/${filename.replace('.md', '')}`
        }
      }
      return null
    }).filter(Boolean)
  } catch (error) {
    console.warn('Could not read monthly directory:', error)
    return []
  }
}

export default defineConfig({
  title: 'Ruby on Rails PR Digest',
  description: 'Ruby on Railsã®æœ€æ–°å¤‰æ›´ã‚’è¿½è·¡ - rails/railsã®ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPRã‚’è‡ªå‹•è¦ç´„',
  lang: 'ja',

  // GitHub Pages deployment
  base: '/rails-pr-digest/',

  // Theme configuration
  themeConfig: {
    logo: 'ğŸš‚',

    nav: [
      { text: 'ãƒ›ãƒ¼ãƒ ', link: '/' },
      { text: 'æœˆåˆ¥ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–', link: '/monthly/' }
    ],

    sidebar: [
      {
        text: 'ğŸ“… æœˆåˆ¥ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆ',
        items: getMonthlyItems()
      }
    ],

    socialLinks: [
      { icon: 'github', link: 'https://github.com/rails/rails' }
    ],

    footer: {
      message: 'Generated by GitHub Actions & OpenAI GPT-4o',
      copyright: 'ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: rails/rails'
    },

    // Search configuration
    search: {
      provider: 'local',
      options: {
        locales: {
          root: {
            translations: {
              button: {
                buttonText: 'æ¤œç´¢',
                buttonAriaLabel: 'æ¤œç´¢'
              },
              modal: {
                noResultsText: 'çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                resetButtonTitle: 'ãƒªã‚»ãƒƒãƒˆ',
                footer: {
                  selectText: 'é¸æŠ',
                  navigateText: 'ç§»å‹•',
                  closeText: 'é–‰ã˜ã‚‹'
                }
              }
            }
          }
        }
      }
    },

    // Page meta
    editLink: {
      pattern: 'https://github.com/rails/rails/pulls',
      text: 'rails/rails PRsã‚’è¦‹ã‚‹'
    },

    lastUpdated: {
      text: 'æœ€çµ‚æ›´æ–°',
      formatOptions: {
        dateStyle: 'medium',
        timeStyle: 'short'
      }
    }
  },

  // Markdown configuration
  markdown: {
    theme: {
      light: 'github-light',
      dark: 'github-dark'
    },
    lineNumbers: true
  },

  // Head tags
  head: [
    ['link', { rel: 'icon', href: '/rails-pr-digest/favicon.ico' }],
    ['meta', { name: 'theme-color', content: '#cc0000' }],
    ['meta', { property: 'og:type', content: 'website' }],
    ['meta', { property: 'og:locale', content: 'ja' }],
    ['meta', { property: 'og:title', content: 'Ruby on Rails PR Digest' }],
    ['meta', { property: 'og:site_name', content: 'Ruby on Rails PR Digest' }],
    ['meta', { property: 'og:description', content: 'rails/railsã®ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPRã‚’è‡ªå‹•è¦ç´„' }]
  ]
})
